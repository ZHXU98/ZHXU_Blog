
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
<h2>python爬虫入门_练习二_静态页面图片爬_(adnmb)</h2>
<div class="blogpost-body" id="cnblogs_post_body">
<!-- flowchart 箭头图标 勿删 -->
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p>与前文差不多</p>
<h5><a id="1_1"></a>1.前置知识</h5>
<ul>
<li>html一些知识</li>
<li>python基本语法</li>
<li>简单的一些爬虫库api调用</li>
</ul>
<h5><a id="2_7"></a>2.所用到的包</h5>
<ul>
<li>requests</li>
<li>bs4 import BeautifulSoup Beautiful Soup 是一个可以从HTML或XML文件中提取数据的Python库(可以理解为 一个处理文本工具吧)</li>
<li>os</li>
<li>sys<br/>
<a href="https://cn.python-requests.org/zh_CN/latest/" rel="nofollow">https://cn.python-requests.org/zh_CN/latest/</a><br/>
<a href="https://beautifulsoup.readthedocs.io/zh_CN/latest/" rel="nofollow">https://beautifulsoup.readthedocs.io/zh_CN/latest/</a></li>
</ul>
<h5><a id="3_15"></a>3.我练习所遇到的问题</h5>
<ul>
<li>爬取时不知道 串(帖子) 有多少页 (用了个不太好的办法判断)</li>
</ul>
<h2><a id="_18"></a>正文</h2>
<p>这次我尝试去abnmb 女装版 爬取图片(<s>震惊</s>)<br/>
基本操作与练习一 差不多</p>
<h2><a id="1_22"></a>步骤1</h2>
<p>与之前一样<br/>
获得html返回</p>
<pre><code class="prism language-py">user_agent <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36 OPR/26.0.1656.60'</span><span class="token punctuation">,</span>
		<span class="token string">'Opera/8.0 (Windows NT 5.1; U; en)'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 5.1; U; en; rv:1.8.1) Gecko/20061208 Firefox/2.0.0 Opera 9.50'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; en) Opera 9.50'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2 '</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/2.0 Safari/536.11'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.84 Safari/535.11 SE 2.X MetaSr 1.0'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; SE 2.X MetaSr 1.0)'</span>
<span class="token punctuation">]</span>
ers <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">get_html</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span> <span class="token punctuation">:</span> 
        <span class="token keyword">try</span> <span class="token punctuation">:</span> 
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>user_agent<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  timeout<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">global</span> ers
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 "</span><span class="token punctuation">,</span> ers<span class="token punctuation">,</span> <span class="token string">" loop "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            ers <span class="token operator">=</span> ers <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">continue</span>
    <span class="token comment"># print(res.encoding)  #查看网页返回的字符集类型</span>
    <span class="token keyword">return</span> res
</code></pre>
<h2><a id="2_62"></a>步骤2</h2>
<p>这里我们打开页面  我们发现如果不点开回应 就无法得到所有链接 点开回应之后进入新页面<br/>
<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20191110124635664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODMxMzQw,size_16,color_FFFFFF,t_70"/><br/>
所以我构建了一个新函数 获得当前页面所有的回应指向的地址<br/>
<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20191110125500159.png"/></p>
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">get_h_threads_list</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">'https://adnmb2.com/f/%E6%91%84%E5%BD%B12'</span>
    url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://adnmb2.com'</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    html <span class="token operator">=</span> get_html<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"adnmb/html.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    btn_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-info-reply-btn'</span><span class="token punctuation">)</span>
    a_href <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>btn_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
    btn_url_list <span class="token operator">=</span> a_href<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token keyword">global</span> url_list
    <span class="token keyword">for</span> i <span class="token keyword">in</span> btn_url_list <span class="token punctuation">:</span>
        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>base_url <span class="token operator">+</span> i<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>base_url <span class="token operator">+</span> i<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2><a id="3_88"></a>步骤3</h2>
<p>获得我们得到串地址 内所有的图片 src<br/>
<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20191110125851849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODMxMzQw,size_16,color_FFFFFF,t_70"/></p>
<p>获得class=“h-threads-img-a” href 并且 以  class=“h-threads-info-id” id 作为文件名</p>
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">get_page_pic</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> get_page<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">sum</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        nxt_url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>nxt_url<span class="token punctuation">)</span>
        html <span class="token operator">=</span> get_html<span class="token punctuation">(</span>nxt_url<span class="token punctuation">)</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        div_reply <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-item-reply'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> div_reply <span class="token punctuation">:</span>
            pic_href <span class="token operator">=</span> i<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-img-a'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pic_href<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> 
                <span class="token keyword">continue</span>
            a_id <span class="token operator">=</span> i<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-info-id'</span><span class="token punctuation">)</span>
            <span class="token builtin">id</span> <span class="token operator">=</span> a_id<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>string
            <span class="token keyword">if</span><span class="token punctuation">(</span>download<span class="token punctuation">(</span>pic_href<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span> <span class="token operator">or</span> <span class="token builtin">id</span> <span class="token operator">!=</span> <span class="token string">'No.9999999'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">continue</span>
</code></pre>
<p>下载图片并保存本地</p>
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'adnmb/data2/'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">while</span> <span class="token number">1</span> <span class="token punctuation">:</span>
        cnt <span class="token operator">=</span> cnt <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">break</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> closing<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>user_agent<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  timeout<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> r<span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'adnmb/data2/'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string">'ab+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span>chunk_size <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> chunk<span class="token punctuation">:</span>
                            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                            f<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">global</span> ers
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 "</span><span class="token punctuation">,</span> ers<span class="token punctuation">,</span> <span class="token string">" loop "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            ers <span class="token operator">=</span> ers <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>
</code></pre>
<h2><a id="4_139"></a>步骤4</h2>
<p>获得当前串有多少页</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20191110155058254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODMxMzQw,size_16,color_FFFFFF,t_70"/><br/>
其实这样我获取的 最多只有前11页<br/>
如果我们考虑 判断某页元素重复出现break就好了</p>
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">get_page</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    html <span class="token operator">=</span> get_html<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    ul_page <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'uk-pagination uk-pagination-left h-pagination'</span><span class="token punctuation">)</span>
    li_page <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ul_page<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li_url <span class="token operator">=</span> li_page<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
    <span class="token comment"># print(li_url)</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>li_url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span>
</code></pre>
<p>以下完整代码</p>
<pre><code class="prism language-py"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
<span class="token keyword">import</span> random
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> request
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing
<span class="token keyword">import</span> json


user_agent <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36 OPR/26.0.1656.60'</span><span class="token punctuation">,</span>
		<span class="token string">'Opera/8.0 (Windows NT 5.1; U; en)'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 5.1; U; en; rv:1.8.1) Gecko/20061208 Firefox/2.0.0 Opera 9.50'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; en) Opera 9.50'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2 '</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/2.0 Safari/536.11'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.84 Safari/535.11 SE 2.X MetaSr 1.0'</span><span class="token punctuation">,</span>
		<span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; SE 2.X MetaSr 1.0)'</span>
<span class="token punctuation">]</span>
ers <span class="token operator">=</span> <span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">get_html</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span> <span class="token punctuation">:</span> 
        <span class="token keyword">try</span> <span class="token punctuation">:</span> 
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>user_agent<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  timeout<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">global</span> ers
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 "</span><span class="token punctuation">,</span> ers<span class="token punctuation">,</span> <span class="token string">" loop "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            ers <span class="token operator">=</span> ers <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">continue</span>
    <span class="token comment"># print(res.encoding)  #查看网页返回的字符集类型</span>
    <span class="token keyword">return</span> res

url_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">get_h_threads_list</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">'https://adnmb2.com/f/%E6%91%84%E5%BD%B12'</span>
    url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://adnmb2.com'</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    html <span class="token operator">=</span> get_html<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"adnmb/html.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    btn_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-info-reply-btn'</span><span class="token punctuation">)</span>
    a_href <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>btn_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
    btn_url_list <span class="token operator">=</span> a_href<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token keyword">global</span> url_list
    <span class="token keyword">for</span> i <span class="token keyword">in</span> btn_url_list <span class="token punctuation">:</span>
        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>base_url <span class="token operator">+</span> i<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>base_url <span class="token operator">+</span> i<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'adnmb/data2/'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">while</span> <span class="token number">1</span> <span class="token punctuation">:</span>
        cnt <span class="token operator">=</span> cnt <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">break</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> closing<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>user_agent<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  timeout<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> r<span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'adnmb/data2/'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string">'ab+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span>chunk_size <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> chunk<span class="token punctuation">:</span>
                            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                            f<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">global</span> ers
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 "</span><span class="token punctuation">,</span> ers<span class="token punctuation">,</span> <span class="token string">" loop "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            ers <span class="token operator">=</span> ers <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">get_page</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    html <span class="token operator">=</span> get_html<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    ul_page <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'uk-pagination uk-pagination-left h-pagination'</span><span class="token punctuation">)</span>
    li_page <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ul_page<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li_url <span class="token operator">=</span> li_page<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
    <span class="token comment"># print(li_url)</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>li_url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span>


<span class="token keyword">def</span> <span class="token function">get_page_pic</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> get_page<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">sum</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        nxt_url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'?page='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>nxt_url<span class="token punctuation">)</span>
        html <span class="token operator">=</span> get_html<span class="token punctuation">(</span>nxt_url<span class="token punctuation">)</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        div_reply <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-item-reply'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> div_reply <span class="token punctuation">:</span>
            pic_href <span class="token operator">=</span> i<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-img-a'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pic_href<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> 
                <span class="token keyword">continue</span>
            a_id <span class="token operator">=</span> i<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'h-threads-info-id'</span><span class="token punctuation">)</span>
            <span class="token builtin">id</span> <span class="token operator">=</span> a_id<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>string
            <span class="token keyword">if</span><span class="token punctuation">(</span>download<span class="token punctuation">(</span>pic_href<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span> <span class="token operator">or</span> <span class="token builtin">id</span> <span class="token operator">!=</span> <span class="token string">'No.9999999'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">continue</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span> <span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
        get_h_threads_list<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>url_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> url_list <span class="token punctuation">:</span>
        get_page_pic<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

</code></pre>
</div>
</body>
</html>
